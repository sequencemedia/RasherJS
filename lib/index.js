'use strict';Object.defineProperty(exports,"__esModule",{value:true});exports.Rasher=undefined;var _listener2=require('./dom/listener');var _delegate2=require('./dom/delegate');var _query3=require('./dom/query');function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}/* eslint no-cond-assign: 0 */var stopFactory=function stopFactory(subscription){return function(){subscription.stop();};};var has=function has(array,index){return typeof index==='number'/* IS NUMBER */&&!(index<0)/* LOWER BOUND (index not less than zero) */&&array.length>index/* UPPER BOUND (length more than index) */;};var stopAll=function stopAll(subscriptionList){if(subscriptionList.length===0)return false;var subscription=void 0;while(subscription=subscriptionList.shift()){subscription.stop();}return true;};var listAll=function listAll(subscriptionList){return{// get length () { return subscriptionList.length } // old IE safe?
node:function node(index){return has(subscriptionList,index)?subscriptionList[index].node:null;},type:function type(index){return has(subscriptionList,index)?subscriptionList[index].type:null;},stop:function stop(index){if(has(subscriptionList,index)){subscriptionList.splice(index,1).shift().stop();return true;}return false;},indexOf:function indexOf(node){return subscriptionList.findIndex(function(_ref){var n=_ref.node;return node===n;});},size:function size(){return subscriptionList.length;}};};var delegateRasher=function delegateRasher(){var _delegate=void 0;var _query=void 0;var _rasher=void 0;return{delegate:function delegate(){return _delegate||(_delegate=new _delegate2.Delegate());},query:function query(){return _query||(_query=new _query3.Query());},rasher:function rasher(){return _rasher||(_rasher={stopAll:stopAll,listAll:listAll});}};};var listenerRasher=function listenerRasher(){var _listener=void 0;var _query2=void 0;var _rasher2=void 0;return{listener:function listener(){return _listener||(_listener=new _listener2.Listener());},query:function query(){return _query2||(_query2=new _query3.Query());},rasher:function rasher(){return _rasher2||(_rasher2={stopAll:stopAll,listAll:listAll});}};};var delegateFacade=function delegateFacade(rasher,list,node,selector){return{on:function on(type){if(typeof type!=='string')return null;return{do:function _do(handler){var _ref2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},context=_ref2.context,phase=_ref2.phase;if((handler||false).constructor!==Function)return null;var delegate=rasher.delegate();list.push({type:type,node:node,stop:stopFactory(delegate.subscribe(type,node,selector,handler,context,phase))});}};}};};var listenerFacade=function listenerFacade(rasher,list,node){return{on:function on(type){if(typeof type!=='string')return null;return{do:function _do(handler){var _ref3=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},context=_ref3.context,phase=_ref3.phase;if((handler||false).constructor!==Function)return null;var listener=rasher.listener();list.push({type:type,node:node,stop:stopFactory(listener.subscribe(type,node,handler,context,phase))});}};}};};var find=function find(selector){return{delegateTo:function delegateTo(delegate){return{then:function then(callOut){var rasher=delegateRasher();var q=rasher.query();var k=rasher.rasher();if((callOut||false).constructor!==Function)return{stopAll:function stopAll(){return false;},listAll:function listAll(){return[];}};var nodeList=q.queryForNodeList(delegate);var i=0;var j=nodeList.length;var subscriptionList=[];// always an array
if(i<j){var _loop=function _loop(){var subscriptionNode=nodeList[i];var face=delegateFacade(rasher,subscriptionList,subscriptionNode,selector);var list=function list(_ref4){var node=_ref4.node;return subscriptionNode===node;};var each=function each(x){var z=subscriptionList.findIndex(function(y){return x===y;});subscriptionList.splice(z,1).shift().stop();};callOut.call(subscriptionNode,face,{node:function node(){return subscriptionNode;},stop:function stop(){var a=subscriptionList.filter(list);if(a.length===0)return false;a.forEach(each);return true;},index:function index(){return subscriptionList.findIndex(list);},size:function size(){return subscriptionList.length;}},i,j);};do{_loop();}while((i=i+1)<j);}return{stopAll:function stopAll(){return k.stopAll(subscriptionList);},listAll:function listAll(){return k.listAll(subscriptionList);}};},toArray:function toArray(){var q=new _query3.Query();return Array.from(q.queryForNodeList(selector)).concat(Array.from(q.queryForNodeList(delegate)));}};},then:function then(callOut){if((callOut||false).constructor!==Function)return{stopAll:function stopAll(){return false;},listAll:function listAll(){return[];}};var rasher=listenerRasher();var q=rasher.query();var k=rasher.rasher();var nodeList=q.queryForNodeList(selector);var i=0;var j=nodeList.length;var subscriptionList=[];// always an array
if(i<j){var _loop2=function _loop2(){var subscriptionNode=nodeList[i];var face=listenerFacade(rasher,subscriptionList,subscriptionNode);var list=function list(_ref5){var node=_ref5.node;return subscriptionNode===node;};var each=function each(x){var z=subscriptionList.findIndex(function(y){return x===y;});subscriptionList.splice(z,1).shift().stop();};callOut.call(subscriptionNode,face,{node:function node(){return subscriptionNode;},stop:function stop(){var a=subscriptionList.filter(list);if(a.length===0)return false;a.forEach(each);return true;},index:function index(){return subscriptionList.findIndex(list);},size:function size(){return subscriptionList.length;}},i,j);};do{_loop2();}while((i=i+1)<j);}return{stopAll:function stopAll(){return k.stopAll(subscriptionList);},listAll:function listAll(){return k.listAll(subscriptionList);}};},toArray:function toArray(){var q=new _query3.Query();var nodeList=q.queryForNodeList(selector);return Array.from(nodeList);}};};var Rasher=exports.Rasher=function Rasher(){_classCallCheck(this,Rasher);this.find=find;};